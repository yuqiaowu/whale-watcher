# 🐋 AI クジラ監視＆自動取引システム (Dolores V1.4)

本システムは、**オンチェーンのクジラ分析**、**テクニカル指標**、**グローバルマクロセンチメント**、そして**強化学習スタイルのAI意思決定**を融合させた、高度な自律型暗号資産取引システムです。

AIエージェント「Dolores」は24時間365日市場を監視し、異常（例：個人投資家のパニック売り vs クジラの底値買い）を検知します。OKXでの自動取引（実盤・デモトレード対応）を実行すると同時に、すべての分析データをサーバーレスでフロントエンドに同期します。

---

## 🌟 主な機能 (Key Features)

### 1. 六次元の知覚 (Multi-Dimensional Perception)
AIは価格だけでなく、6つの次元を通じて市場を認識します：
*   **🐋 オンチェーン・フロー (Flow)**: イーサリアム (ETH) とソラナ (SOL) におけるクジラの純流入/流出およびステーブルコインの動きを追跡。
*   **📊 テクニカル分析 (Technicals)**: RSI、ADX（トレンド強度）、MACD、**ボリンジャーバンド幅/トレンド (BBW/Trend)** などの高度な指標を使用。
*   **⭐ スター評価 (Star Ratings)**: 価格ランク、出来高の異常値、RSIの極値に基づく自動スコアリングシステム (0-3つ星)。
*   **💸 市場の痛み (Pain)**: **清算データ (Liquidation)** (ロング vs ショートのどちらが焼かれているか) を監視し、反転やショートスクイズの機会を探知。
*   **📉 資金調達率 (Rates)**: 取引の過熱感とスクイズの可能性を検知 (マイナス金利 = ショートの過密)。
*   **🌍 マクロ環境 (Macro)**: 米金利先物、VIX恐怖指数、ドル指数 (DXY)、および世界的なニュースセンチメントを統合。

### 2. 「正直かつ堅牢」なアーキテクチャ (Honest & Robust)
*   **Fail-Loudly**: 指標計算の前にデータセットの十分性 (>50本のローソク足) を厳格に検証します。重要なデータ (例: ADX) が欠落している場合、偽のデフォルト値でAIを誤解させるのではなく、明確にエラーを出力します。
*   **算術的安全性**: 複雑な計算におけるゼロ除算エラーなどを完全に防止しています。

### 3. AI 自己反省ループ (V2.0 Alpha) 🧠
*   **ローリングメモリ (Rolling Memory)**: AIは直近5回の取引の「日記」を保持し、エントリー瞬間の正確な市場コンテキスト (RSI, ADX, クジラフロー) を記録します。
*   **継続的学習**: 新しい意思決定を行う前に、AIはこの日記をレビューし、成功や失敗のパターンを特定します（例：「前回 ADX > 50 の時に逆張りをして損失を出した」）。これにより、変化する市場環境に動的に適応可能となります。

### 4. サーバーレスデータ同期
*   **Git不要**: GitHub REST APIを使用してデータを `data-history` ブランチに直接プッシュします。
*   **ゼロメンテナンス**: RailwayやVercelなどのステートレス環境に最適です。

---

## 🛠️ システムアーキテクチャ

*   **`backend/crypto_brain.py`**: **情報将校**。オンチェーンデータ (Moralis)、ニュース、マクロデータを収集。
*   **`backend/market_data.py`**: **マイナー**。OKXからOHLCV市場データを取得 (ページネーションで500本のローソク足を取得)。
*   **`backend/technical_analysis.py`**: **アナリスト**。RSI, ADX, ボリンジャーバンド, スター評価などの指標を計算。
*   **`backend/ai_trader.py`**: **ファンドマネージャー**。すべてのコンテキストを集約し、DeepSeek LLMを通じて最終的な取引判断を下す。
*   **`backend/data_sync.py`**: **記録係**。JSONデータをGitHubの `data-history` ブランチにアップロード。
*   **`backend/run_loop.py`**: **スケジューラー**。4時間ごとにシステムを起動。

---

## 🚀 デプロイガイド (Railway)

### 1. 環境変数の設定
Railwayのプロジェクト設定で以下の変数を設定してください：

| 変数名 | 説明 | 例 |
| :--- | :--- | :--- |
| `OKX_API_KEY` | OKX APIキー | `...` |
| `OKX_SECRET_KEY` | OKX シークレット | `...` |
| `OKX_PASSPHRASE` | OKX パスフレーズ | `...` |
| `DEEPSEEK_API_KEY`| DeepSeek AIキー | `sk-...` |
| `MORALIS_API_KEY` | Moralisキー (オンチェーン) | `...` |
| `ETHERSCAN_API_KEY` | Etherscanキー | `...` |
| `GITHUB_TOKEN` | **データ同期に必須**。Repo権限が必要。 | `ghp_...` |
| `REPO_URL` | GitHubリポジトリのURL | `github.com/yourname/whale-watcher` |
| `IS_PAPER_TRADING`| `true`でデモ、`false`で実弾 | `true` |

### 2. フロントエンド統合
バックエンドはデータを自動的に `data-history` ブランチにプッシュします。フロントエンドはRaw URLから直接読み込むべきです：
```
https://raw.githubusercontent.com/username/repo/data-history/frontend/data/whale_analysis.json
```
これにより、フロントエンドを再ビルドすることなく、常に最新の分析を表示できます。

---

## 📊 データ構造 (whale_analysis.json)

生成されるJSONファイルには以下が含まれます：
*   **`eth`, `sol`, `btc`**: 各資産のセクション。
    *   `market`: リアルタイム価格、テクニカル指標 (RSI, ADX, BBW, Funding)。
    *   `stats_24h`: クジラのフロー、清算データ。
    *   `history_60d`: 過去60期間の履歴データ配列（チャート描画用）。
*   **`ai_summary`**: 現在の市場状態に対するAIの分析コメント（日英対応）。
*   **`actions`**: 実行された取引判断のリスト (Open Long, Shortなど)。

---

## 🛡️ リスク開示
本システムは実験的なAIエージェントです。高度なロジックと多次元データを使用していますが、暗号資産市場は非常にボラティリティが高いです。実資金を投入する前に、デモトレードモードで十分にテストすることを強く推奨します。

---
*Built with ❤️ by Deepmind Advanced Coding Agent.*
